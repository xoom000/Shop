<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Linen Supply</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- iOS PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mission Linen">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMwYTBhMGEiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMGY1ZmYiIHN0cm9rZS13aWR0aD0iMiI+CjxwYXRoIGQ9Im0zIDlsOS00IDktNHY2bC05IDR2NGwtOS00eiIvPgo8cGF0aCBkPSJtMjEgMTZsLTktNGEyIDIgMCAwIDAtMiAwbC05IDQiLz4KPHA+PC9wPgo8L3N2Zz4KPC9zdmc+">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#00f5ff">
    <meta name="msapplication-navbutton-color" content="#00f5ff">
    <meta name="msapplication-TileColor" content="#0a0a0a">
    <style>
        :root {
            --neon-blue: #00f5ff;
            --neon-green: #39ff14;
            --neon-pink: #ff00aa;
            --neon-orange: #ff6600;
            --neon-purple: #9d4edd;
            --cyber-black: #0a0a0a;
            --dark-bg: #1a1a1a;
            --card-bg: rgba(26, 26, 26, 0.95);
            --text-primary: #ffffff;
            --text-muted: #888888;
            --border-glow: rgba(0, 245, 255, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--cyber-black) 0%, var(--dark-bg) 100%);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
            padding-bottom: 80px; /* Space for bottom nav */
        }

        /* Mobile-First Header */
        .ml-header {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border-glow);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 15px;
        }

        .ml-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .ml-logo {
            font-size: 1.2rem;
            font-weight: bold;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .ml-header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .ml-menu-btn, .ml-cart-btn {
            background: rgba(0, 245, 255, 0.1);
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .ml-cart-btn {
            background: linear-gradient(45deg, var(--neon-green), var(--neon-blue));
            color: var(--cyber-black);
        }

        .ml-cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--neon-pink);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .ml-search-bar {
            position: relative;
        }

        .ml-search-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-glow);
            color: var(--text-primary);
            padding: 12px 40px 12px 15px;
            border-radius: 25px;
            font-size: 16px; /* Prevent zoom on iOS */
        }

        .ml-search-input:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 10px var(--border-glow);
        }

        .ml-search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--neon-blue);
            font-size: 18px;
            cursor: pointer;
        }

        /* Category Pills - Horizontal Scroll */
        .ml-category-pills {
            padding: 15px;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            scroll-behavior: smooth;
        }

        .ml-category-pills::-webkit-scrollbar {
            display: none;
        }

        .ml-category-pill {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            position: relative;
            min-width: fit-content;
        }

        .ml-category-pill.ml-active {
            background: var(--pill-color);
            color: var(--cyber-black);
            border-color: var(--pill-color);
            box-shadow: 0 0 15px var(--pill-color);
        }

        .ml-category-pill:not(.ml-active):hover {
            background: rgba(0, 245, 255, 0.1);
            border-color: var(--pill-color);
        }

        .ml-pill-icon {
            font-size: 16px;
        }

        .ml-pill-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
        }

        .ml-category-pill.ml-active .ml-pill-count {
            background: rgba(0, 0, 0, 0.3);
        }

        /* Content Area */
        .ml-content {
            padding: 0 15px;
        }

        .ml-content-header {
            padding: 20px 0 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ml-page-title {
            font-size: 1.5rem;
            color: var(--neon-green);
            text-shadow: 0 0 10px var(--neon-green);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ml-results-count {
            color: var(--text-muted);
            font-size: 14px;
        }

        .ml-sort-btn {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-glow);
            color: var(--text-primary);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Mobile Product Grid */
        .ml-products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding-bottom: 20px;
        }

        .ml-product-card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .ml-product-card:active {
            transform: scale(0.98);
        }

        .ml-product-image {
            height: 120px;
            background: linear-gradient(135deg, var(--product-color), rgba(157, 78, 221, 0.1));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            position: relative;
        }

        .ml-bestseller-badge {
            position: absolute;
            top: 6px;
            right: 6px;
            background: var(--neon-pink);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 8px;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 0 8px var(--neon-pink);
        }

        .ml-product-info {
            padding: 12px;
        }

        .ml-product-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 12px;
            line-height: 1.3;
            min-height: 32px;
            margin-bottom: 6px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .ml-product-sku {
            color: var(--text-muted);
            font-size: 9px;
            margin-bottom: 6px;
        }

        .ml-product-price {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--neon-green);
            text-shadow: 0 0 5px var(--neon-green);
            margin-bottom: 2px;
        }

        .ml-product-unit {
            color: var(--text-muted);
            font-size: 9px;
            margin-bottom: 10px;
        }

        .ml-product-actions {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .ml-qty-control {
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-glow);
            border-radius: 15px;
            overflow: hidden;
            flex: 1;
        }

        .ml-qty-btn {
            background: none;
            border: none;
            color: var(--neon-blue);
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .ml-qty-btn:active {
            background: rgba(0, 245, 255, 0.2);
        }

        .ml-qty-input {
            flex: 1;
            text-align: center;
            background: none;
            border: none;
            color: var(--text-primary);
            font-weight: bold;
            font-size: 14px;
            height: 32px;
        }

        .ml-add-btn {
            background: linear-gradient(45deg, var(--neon-green), var(--neon-blue));
            border: none;
            color: var(--cyber-black);
            width: 40px;
            height: 32px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ml-add-btn:active {
            transform: scale(0.95);
            box-shadow: 0 3px 10px var(--success-glow);
        }

        /* List Panel */
        .ml-list-panel {
            position: fixed;
            bottom: 60px;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(10, 10, 10, 0.98), rgba(20, 20, 30, 0.95));
            border-top: 2px solid var(--neon-cyan);
            max-height: 50vh;
            transform: translateY(calc(100% + 60px));
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 998;
            display: flex;
            flex-direction: column;
        }

        .ml-list-panel.ml-active {
            transform: translateY(0);
        }

        .ml-list-panel-header {
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ml-list-panel-title {
            color: var(--neon-green);
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ml-list-panel-actions {
            display: flex;
            gap: 10px;
        }

        .ml-list-clear-btn {
            background: rgba(255, 0, 170, 0.2);
            border: 1px solid var(--neon-pink);
            color: var(--neon-pink);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            cursor: pointer;
        }

        .ml-list-minimize-btn {
            background: transparent;
            border: none;
            color: var(--neon-cyan);
            font-size: 20px;
            cursor: pointer;
            padding: 0 5px;
        }

        .ml-list-items-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .ml-list-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .ml-list-item-info {
            flex: 1;
        }

        .ml-list-item-name {
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .ml-list-item-sku {
            color: var(--text-muted);
            font-size: 10px;
        }

        .ml-list-item-price {
            color: var(--neon-cyan);
            font-size: 11px;
        }

        .ml-list-item-controls {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .ml-list-item-qty {
            color: var(--neon-green);
            font-size: 12px;
            padding: 0 8px;
        }

        .ml-list-item-remove {
            background: rgba(255, 0, 0, 0.2);
            border: none;
            color: #ff4444;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .ml-list-total {
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.7);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ml-list-total-label {
            color: var(--text-muted);
            font-size: 12px;
        }

        .ml-list-total-amount {
            color: var(--neon-green);
            font-size: 18px;
            font-weight: bold;
            text-shadow: 0 0 10px var(--neon-green);
        }

        .ml-copy-button-bar {
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 8px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .ml-copy-button-bar::-webkit-scrollbar {
            display: none;
        }

        .ml-copy-btn {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.2), rgba(57, 255, 20, 0.2));
            border: 1px solid var(--neon-cyan);
            color: var(--text-primary);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 11px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .ml-copy-btn:active {
            background: var(--neon-green);
            color: black;
            transform: scale(0.95);
        }

        .ml-copy-btn.ml-copied {
            background: var(--neon-green);
            color: black;
            animation: pulse 0.5s;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .ml-list-toggle-btn {
            position: fixed;
            bottom: 70px;
            right: 15px;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-green));
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: black;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 245, 255, 0.5);
            z-index: 997;
            transition: all 0.3s;
            display: none;
        }

        .ml-list-toggle-btn.ml-has-items {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ml-list-toggle-btn:active {
            transform: scale(0.9);
        }

        .ml-list-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--neon-pink);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }

        /* Bottom Navigation */
        .ml-bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            border-top: 1px solid var(--border-glow);
            padding: 10px 0;
            display: flex;
            justify-content: space-around;
            z-index: 200;
        }

        .ml-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.3s;
            padding: 5px 10px;
            border-radius: 10px;
            position: relative;
        }

        .ml-nav-item.ml-active {
            background: rgba(0, 245, 255, 0.1);
            color: var(--neon-blue);
        }

        .ml-nav-icon {
            font-size: 20px;
        }

        .ml-nav-label {
            font-size: 10px;
            font-weight: 500;
        }

        .ml-nav-badge {
            position: absolute;
            top: 2px;
            right: 8px;
            background: var(--neon-pink);
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Mobile Category Menu Overlay */
        .ml-category-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 300;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .ml-category-overlay.ml-active {
            display: flex;
        }

        .ml-category-menu {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border-glow);
            border-radius: 20px;
            padding: 30px;
            max-width: 350px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .ml-category-menu-title {
            text-align: center;
            font-size: 1.3rem;
            color: var(--neon-green);
            margin-bottom: 25px;
        }

        .ml-category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .ml-category-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ml-category-item:active {
            transform: scale(0.95);
        }

        .ml-category-item:hover {
            border-color: var(--item-color);
            background: rgba(0, 245, 255, 0.1);
        }

        .ml-category-item-icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
            filter: drop-shadow(0 0 8px var(--item-color));
        }

        .ml-category-item-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--item-color);
            margin-bottom: 3px;
        }

        .ml-category-item-count {
            font-size: 10px;
            color: var(--text-muted);
        }

        .ml-close-menu {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
        }

        /* Loading States */
        .ml-loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
            grid-column: 1/-1;
        }

        .ml-spinner {
            border: 3px solid rgba(0, 245, 255, 0.1);
            border-top: 3px solid var(--neon-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Pull to refresh indicator */
        .ml-pull-indicator {
            text-align: center;
            padding: 10px;
            color: var(--text-muted);
            font-size: 12px;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        .ml-pull-indicator.ml-active {
            transform: translateY(0);
        }

        /* Haptic feedback simulation */
        @keyframes haptic {
            0% { transform: scale(1); }
            50% { transform: scale(0.98); }
            100% { transform: scale(1); }
        }

        .ml-haptic {
            animation: haptic 0.1s ease;
        }
    </style>
</head>
<body>
    <!-- Pull to refresh indicator -->
    <div class="ml-pull-indicator" id="pullIndicator">
        ↓ Pull to refresh
    </div>

    <!-- Mobile Header -->
    <header class="ml-header">
        <div class="ml-header-row">
            <div class="ml-logo">MISSION LINEN</div>
            <div class="ml-header-actions">
                <button class="ml-menu-btn" onclick="MissionLinen.showCategoryMenu()">☰</button>
                <button class="ml-cart-btn" onclick="MissionLinen.viewCart()">
                    🛒
                    <span class="ml-cart-count" id="cartCount">0</span>
                </button>
            </div>
        </div>
        
        <div class="ml-search-bar">
            <input type="text" class="ml-search-input" id="searchInput" placeholder="Search products...">
            <button class="ml-search-btn">🔍</button>
        </div>
    </header>

    <!-- Category Pills -->
    <div class="ml-category-pills" id="categoryPills">
        <!-- Category pills will be loaded here -->
    </div>

    <!-- Content -->
    <main class="ml-content">
        <div class="ml-content-header">
            <div>
                <h1 class="ml-page-title" id="pageTitle">
                    <span id="pageTitleIcon">🏠</span>
                    All Products
                </h1>
                <div class="ml-results-count" id="resultsCount">Loading...</div>
            </div>
            <button class="ml-sort-btn" onclick="MissionLinen.toggleSort()">
                <span id="sortLabel">Popular</span> ↕
            </button>
        </div>

        <div class="ml-products-grid" id="productsGrid">
            <div class="ml-loading">
                <div class="ml-spinner"></div>
                <p>Loading products...</p>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="ml-bottom-nav">
        <div class="ml-nav-item ml-active" onclick="MissionLinen.bottomNav('home', this)">
            <div class="ml-nav-icon">🏠</div>
            <div class="ml-nav-label">Home</div>
        </div>
        <div class="ml-nav-item" onclick="MissionLinen.bottomNav('categories', this)">
            <div class="ml-nav-icon">📦</div>
            <div class="ml-nav-label">Categories</div>
        </div>
        <div class="ml-nav-item" onclick="MissionLinen.bottomNav('bestsellers', this)">
            <div class="ml-nav-icon">🔥</div>
            <div class="ml-nav-label">Best Sellers</div>
            <div class="ml-nav-badge">15</div>
        </div>
        <div class="ml-nav-item" onclick="MissionLinen.bottomNav('search', this)">
            <div class="ml-nav-icon">🔍</div>
            <div class="ml-nav-label">Search</div>
        </div>
        <div class="ml-nav-item" onclick="MissionLinen.bottomNav('cart', this)">
            <div class="ml-nav-icon">🛒</div>
            <div class="ml-nav-label">Cart</div>
            <div class="ml-nav-badge" id="bottomCartCount">0</div>
        </div>
    </nav>

    <!-- List Panel -->
    <div class="ml-list-panel" id="listPanel">
        <div class="ml-list-panel-header">
            <div class="ml-list-panel-title">
                📋 Order List <span id="listCount">(0)</span>
            </div>
            <div class="ml-list-panel-actions">
                <button class="ml-list-clear-btn" onclick="MissionLinen.clearList()">Clear</button>
                <button class="ml-list-minimize-btn" onclick="MissionLinen.toggleListPanel()">⌄</button>
            </div>
        </div>
        <div class="ml-list-items-container" id="listItems">
            <!-- List items will appear here -->
        </div>
        <div class="ml-list-total">
            <span class="ml-list-total-label">Total:</span>
            <span class="ml-list-total-amount" id="listTotal">$0.00</span>
        </div>
        <div class="ml-copy-button-bar">
            <button class="ml-copy-btn" onclick="MissionLinen.copyFormat('boss')">📋 For Boss</button>
            <button class="ml-copy-btn" onclick="MissionLinen.copyFormat('team')">👥 For Team</button>
            <button class="ml-copy-btn" onclick="MissionLinen.copyFormat('customer')">📄 Quote</button>
            <button class="ml-copy-btn" onclick="MissionLinen.copyFormat('skus')">🔢 SKUs Only</button>
            <button class="ml-copy-btn" onclick="MissionLinen.shareList()">📤 Share</button>
        </div>
    </div>

    <!-- List Toggle Button -->
    <button class="ml-list-toggle-btn" id="listToggleBtn" onclick="MissionLinen.toggleListPanel()">
        📋
        <span class="ml-list-badge" id="listToggleBadge">0</span>
    </button>

    <!-- Category Menu Overlay -->
    <div class="ml-category-overlay" id="categoryOverlay">
        <div class="ml-category-menu">
            <button class="ml-close-menu" onclick="MissionLinen.hideCategoryMenu()">×</button>
            <h2 class="ml-category-menu-title">Select Category</h2>
            <div class="ml-category-grid" id="categoryGrid">
                <!-- Category grid will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // MissionLinen namespace to prevent global conflicts
        const MissionLinen = {
            // State variables
            catalog: null,
            cart: [],
            orderList: [],
            currentView: 'all',
            currentProducts: [],
            currentSort: 'popularity',
            customerInfo: {
                name: 'Customer',
                account: '000000'
            },
            favorites: {
                bestDeals: [],
                customerFaves: [],
                quickRef: [],
                recentlyViewed: []
            },
            categoryConfig: {
                'safety-ppe': { color: '#ff00aa', icon: '🧤', name: 'Safety & PPE' },
                'food-packaging': { color: '#00f5ff', icon: '📦', name: 'Food Packaging' },
                'paper-products': { color: '#39ff14', icon: '🧻', name: 'Paper Products' },
                'janitorial': { color: '#ff6600', icon: '🧹', name: 'Janitorial' },
                'drinkware': { color: '#9d4edd', icon: '🥤', name: 'Drinkware' },
                'tableware': { color: '#f72585', icon: '🍴', name: 'Tableware' },
                'food-wrap': { color: '#4cc9f0', icon: '🎁', name: 'Food Wrap' }
            },

            // Initialize
            async init() {
                try {
                    // Show loading state
                    const productsGrid = document.getElementById('productsGrid');
                    if (productsGrid) {
                        productsGrid.innerHTML = `
                            <div class="ml-loading">
                                <div class="ml-spinner"></div>
                                <p>Loading catalog...</p>
                            </div>
                        `;
                    }
                    
                    // Fetch catalog with timeout
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout
                    
                    const response = await fetch('data/catalog.json', {
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const catalogData = await response.json();
                    
                    // Validate catalog structure
                    if (!catalogData || !catalogData.products || !Array.isArray(catalogData.products)) {
                        throw new Error('Invalid catalog data structure');
                    }
                    
                    this.catalog = catalogData;
                    
                    // Load cart from localStorage with error handling
                    try {
                        const savedCart = localStorage.getItem('missionLinenCart');
                        if (savedCart) {
                            const parsedCart = JSON.parse(savedCart);
                            if (Array.isArray(parsedCart)) {
                                this.cart = parsedCart;
                            }
                        }
                    } catch (cartError) {
                        console.warn('Failed to load saved cart:', cartError);
                        this.cart = []; // Reset to empty cart
                    }
                    
                    // Load order list from localStorage
                    try {
                        const savedList = localStorage.getItem('missionLinenOrderList');
                        if (savedList) {
                            const parsedList = JSON.parse(savedList);
                            if (Array.isArray(parsedList)) {
                                this.orderList = parsedList;
                            }
                        }
                    } catch (listError) {
                        console.warn('Failed to load saved list:', listError);
                        this.orderList = []; // Reset to empty list
                    }
                    
                    // Load favorites
                    try {
                        const savedFavorites = localStorage.getItem('missionLinenFavorites');
                        if (savedFavorites) {
                            this.favorites = JSON.parse(savedFavorites);
                        }
                    } catch (favError) {
                        console.warn('Failed to load favorites:', favError);
                    }
                    
                    // Load customer info
                    try {
                        const savedCustomer = localStorage.getItem('missionLinenCustomer');
                        if (savedCustomer) {
                            this.customerInfo = JSON.parse(savedCustomer);
                        }
                    } catch (custError) {
                        console.warn('Failed to load customer info:', custError);
                    }
                    
                    // Initialize UI components
                    this.renderCategoryPills();
                    this.renderCategoryGrid();
                    this.loadView('all');
                    this.updateCartCount();
                    this.updateListPanel();
                    this.setupSearch();
                    this.setupPullToRefresh();
                    
                } catch (error) {
                    console.error('Error loading catalog:', error);
                    
                    // Show user-friendly error message
                    const productsGrid = document.getElementById('productsGrid');
                    if (productsGrid) {
                        let errorMessage = 'Unable to load catalog. ';
                        
                        if (error.name === 'AbortError') {
                            errorMessage += 'Request timed out. Please check your connection and try again.';
                        } else if (error.message.includes('HTTP')) {
                            errorMessage += 'Server error. Please try again later.';
                        } else if (error.message.includes('Invalid catalog')) {
                            errorMessage += 'Catalog data is corrupted. Please contact support.';
                        } else {
                            errorMessage += 'Please check your connection and refresh the page.';
                        }
                        
                        productsGrid.innerHTML = `
                            <div class="ml-loading" style="grid-column: 1/-1;">
                                <div style="color: #ff6666; font-size: 2rem; margin-bottom: 20px;">⚠️</div>
                                <p style="color: #ff6666; font-weight: bold; margin-bottom: 10px;">Error Loading Catalog</p>
                                <p style="color: #888; margin-bottom: 20px;">${errorMessage}</p>
                                <button onclick="location.reload()" style="background: var(--neon-blue); color: var(--cyber-black); border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer;">
                                    Retry
                                </button>
                            </div>
                        `;
                    }
                }
            },

            // Render category pills
            renderCategoryPills() {
                const pills = document.getElementById('categoryPills');
                let html = `
                    <div class="ml-category-pill ml-active" data-category="all" style="--pill-color: var(--neon-green)" onclick="MissionLinen.selectCategory('all')">
                        <span class="ml-pill-icon">🏠</span>
                        <span>All</span>
                        <span class="ml-pill-count">107</span>
                    </div>
                `;
                
                Object.entries(this.categoryConfig).forEach(([key, config]) => {
                    const products = this.catalog.products.filter(p => p.categoryPath && p.categoryPath[0] === key);
                    if (products.length > 0) {
                        html += `
                            <div class="ml-category-pill" data-category="${key}" style="--pill-color: ${config.color}" onclick="MissionLinen.selectCategory('${key}')">
                                <span class="ml-pill-icon">${config.icon}</span>
                                <span>${config.name.split(' ')[0]}</span>
                                <span class="ml-pill-count">${products.length}</span>
                            </div>
                        `;
                    }
                });

                html += `
                    <div class="ml-category-pill" data-category="bestsellers" style="--pill-color: var(--neon-orange)" onclick="MissionLinen.selectCategory('bestsellers')">
                        <span class="ml-pill-icon">🔥</span>
                        <span>Best</span>
                        <span class="ml-pill-count">15</span>
                    </div>
                    <div class="ml-category-pill" data-category="favorites" style="--pill-color: var(--neon-pink)" onclick="MissionLinen.selectCategory('favorites')">
                        <span class="ml-pill-icon">⭐</span>
                        <span>Favorites</span>
                        <span class="ml-pill-count">${this.getTotalFavorites()}</span>
                    </div>
                    <div class="ml-category-pill" data-category="bestdeals" style="--pill-color: var(--neon-green)" onclick="MissionLinen.selectCategory('bestdeals')">
                        <span class="ml-pill-icon">💰</span>
                        <span>Best Deals</span>
                        <span class="ml-pill-count">${this.favorites.bestDeals.length}</span>
                    </div>
                    <div class="ml-category-pill" data-category="quickref" style="--pill-color: var(--neon-purple)" onclick="MissionLinen.selectCategory('quickref')">
                        <span class="ml-pill-icon">⚡</span>
                        <span>Quick Ref</span>
                        <span class="ml-pill-count">${this.favorites.quickRef.length}</span>
                    </div>
                `;
                
                pills.innerHTML = html;
            },

            // Render category grid for overlay
            renderCategoryGrid() {
                const grid = document.getElementById('categoryGrid');
                let html = '';
                
                Object.entries(this.categoryConfig).forEach(([key, config]) => {
                    const products = this.catalog.products.filter(p => p.categoryPath && p.categoryPath[0] === key);
                    if (products.length > 0) {
                        html += `
                            <div class="ml-category-item" style="--item-color: ${config.color}" onclick="MissionLinen.selectCategoryFromMenu('${key}')">
                                <div class="ml-category-item-icon">${config.icon}</div>
                                <div class="ml-category-item-name">${config.name}</div>
                                <div class="ml-category-item-count">${products.length} products</div>
                            </div>
                        `;
                    }
                });
                
                grid.innerHTML = html;
            },

            // Select category
            selectCategory(category) {
                // Update pill states
                document.querySelectorAll('.ml-category-pill').forEach(pill => {
                    pill.classList.remove('ml-active');
                });
                document.querySelector(`[data-category="${category}"]`).classList.add('ml-active');
                
                // Scroll pill into view
                const selectedPill = document.querySelector(`[data-category="${category}"]`);
                selectedPill.scrollIntoView({ behavior: 'smooth', inline: 'center' });
                
                // Load content
                this.loadView(category);
                
                // Haptic feedback
                this.addHapticFeedback(selectedPill);
            },

            // Select from category menu
            selectCategoryFromMenu(category) {
                this.hideCategoryMenu();
                this.selectCategory(category);
            },

            // Get total favorites count
            getTotalFavorites() {
                return this.favorites.bestDeals.length + this.favorites.customerFaves.length + this.favorites.quickRef.length;
            },

            // Load view content
            loadView(category) {
                this.currentView = category;
                let products = [];
                let title = '';
                let icon = '';
                
                switch(category) {
                    case 'all':
                        products = this.catalog.products;
                        title = 'All Products';
                        icon = '🏠';
                        break;
                    case 'bestsellers':
                        products = this.catalog.products.filter(p => p.times_sold >= 10).sort((a, b) => b.times_sold - a.times_sold);
                        title = 'Best Sellers';
                        icon = '🔥';
                        break;
                    case 'favorites':
                        const allFavSkus = [...this.favorites.bestDeals, ...this.favorites.customerFaves, ...this.favorites.quickRef];
                        products = this.catalog.products.filter(p => allFavSkus.includes(p.sku));
                        title = 'All Favorites';
                        icon = '⭐';
                        break;
                    case 'bestdeals':
                        products = this.catalog.products.filter(p => this.favorites.bestDeals.includes(p.sku));
                        title = 'Best Deals';
                        icon = '💰';
                        break;
                    case 'quickref':
                        products = this.catalog.products.filter(p => this.favorites.quickRef.includes(p.sku));
                        title = 'Quick Reference';
                        icon = '⚡';
                        break;
                    default:
                        products = this.catalog.products.filter(p => p.categoryPath && p.categoryPath[0] === category);
                        const config = this.categoryConfig[category];
                        title = config ? config.name : 'Category';
                        icon = config ? config.icon : '📦';
                }
                
                // Update header
                document.getElementById('pageTitle').innerHTML = `<span id="pageTitleIcon">${icon}</span> ${title}`;
                
                // Render products
                this.renderProducts(products);
            },

            // Render products
            renderProducts(products) {
                try {
                    // Input validation
                    if (!Array.isArray(products)) {
                        console.error('Invalid products array provided to renderProducts');
                        return false;
                    }
                    
                    this.currentProducts = products;
                    
                    // Sort products with error handling
                    const sorted = [...products];
                    try {
                        switch(this.currentSort) {
                            case 'popularity':
                                sorted.sort((a, b) => (b.times_sold || 0) - (a.times_sold || 0));
                                break;
                            case 'price-low':
                                sorted.sort((a, b) => (a.case_price || 0) - (b.case_price || 0));
                                break;
                            case 'price-high':
                                sorted.sort((a, b) => (b.case_price || 0) - (a.case_price || 0));
                                break;
                            case 'name':
                                sorted.sort((a, b) => {
                                    const nameA = a.name || '';
                                    const nameB = b.name || '';
                                    return nameA.localeCompare(nameB);
                                });
                                break;
                            default:
                                console.warn('Unknown sort value:', this.currentSort);
                        }
                    } catch (sortError) {
                        console.warn('Error sorting products:', sortError);
                    }
                    
                    // Update count safely
                    const resultsCount = document.getElementById('resultsCount');
                    if (resultsCount) {
                        resultsCount.textContent = 
                            `${sorted.length} product${sorted.length !== 1 ? 's' : ''}`;
                    }
                    
                    // Render grid safely
                    const grid = document.getElementById('productsGrid');
                    if (!grid) {
                        console.error('Products grid element not found');
                        return false;
                    }
                    
                    if (sorted.length === 0) {
                        grid.innerHTML = `
                            <div class="ml-loading" style="grid-column: 1/-1;">
                                <div style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;">📋</div>
                                <p>No products found</p>
                            </div>
                        `;
                        return true;
                    }
                    
                    try {
                        const productCards = sorted.map(product => {
                            try {
                                return this.renderProductCard(product);
                            } catch (cardError) {
                                console.warn('Error rendering product card:', cardError, product);
                                return ''; // Skip problematic products
                            }
                        }).filter(card => card.length > 0);
                        
                        grid.innerHTML = productCards.join('');
                    } catch (renderError) {
                        console.error('Error rendering product grid:', renderError);
                        grid.innerHTML = `
                            <div class="ml-loading" style="grid-column: 1/-1;">
                                <div style="color: #ff6666; font-size: 2rem; margin-bottom: 20px;">⚠️</div>
                                <p style="color: #ff6666;">Error displaying products</p>
                            </div>
                        `;
                        return false;
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Error in renderProducts:', error);
                    return false;
                }
            },

            // Render product card
            renderProductCard(product) {
                const categoryKey = product.categoryPath ? product.categoryPath[0] : 'default';
                const config = this.categoryConfig[categoryKey] || { color: '#00f5ff', icon: '📦' };
                const isBestSeller = product.times_sold >= 20;
                const isFavorited = this.isInAnyFavorites(product.sku);
                const favCategory = this.getFavoriteCategory(product.sku);
                
                return `
                    <div class="ml-product-card" style="--product-color: ${config.color}20">
                        <div class="ml-product-image">
                            ${isBestSeller ? '<span class="ml-bestseller-badge">BEST SELLER</span>' : ''}
                            <button class="ml-favorite-btn ${isFavorited ? 'ml-favorited' : ''}" 
                                    onclick="MissionLinen.toggleFavorite('${product.sku}', this)" 
                                    title="${isFavorited ? `Remove from ${favCategory}` : 'Add to favorites'}"
                                    style="
                                        position: absolute;
                                        top: 8px;
                                        right: 8px;
                                        background: ${isFavorited ? 'var(--neon-pink)' : 'rgba(0, 0, 0, 0.5)'};
                                        border: none;
                                        color: ${isFavorited ? 'black' : 'white'};
                                        width: 28px;
                                        height: 28px;
                                        border-radius: 50%;
                                        cursor: pointer;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        font-size: 14px;
                                        z-index: 10;
                                        transition: all 0.3s;
                                    ">
                                ${isFavorited ? '⭐' : '☆'}
                            </button>
                            <span style="color: ${config.color};">${config.icon}</span>
                        </div>
                        <div class="ml-product-info">
                            <div class="ml-product-name">${product.name}</div>
                            <div class="ml-product-sku">SKU: ${product.sku}</div>
                            <div class="ml-product-price">$${product.case_price.toFixed(2)}</div>
                            <div class="ml-product-unit">per case</div>
                            <div class="ml-product-actions">
                                <div class="ml-qty-control">
                                    <button class="ml-qty-btn" onclick="MissionLinen.changeQty('${product.sku}', -1)">−</button>
                                    <input type="text" class="ml-qty-input" id="qty-${product.sku}" value="1" readonly>
                                    <button class="ml-qty-btn" onclick="MissionLinen.changeQty('${product.sku}', 1)">+</button>
                                </div>
                                <button class="ml-add-btn" onclick="MissionLinen.addToList('${product.sku}', this)">+</button>
                            </div>
                        </div>
                    </div>
                `;
            },

            // Bottom navigation
            bottomNav(section, navElement = null) {
                try {
                    // Input validation
                    if (!section || typeof section !== 'string') {
                        console.error('Invalid section provided to bottomNav');
                        return false;
                    }
                    
                    // Update nav states
                    document.querySelectorAll('.ml-nav-item').forEach(item => item.classList.remove('ml-active'));
                    
                    // Use passed element or find the clicked one
                    const activeElement = navElement || document.querySelector(`[onclick*="bottomNav('${section}')"]`);
                    if (activeElement) {
                        activeElement.classList.add('ml-active');
                    }
                    
                    switch(section) {
                        case 'home':
                            this.selectCategory('all');
                            break;
                        case 'categories':
                            this.showCategoryMenu();
                            break;
                        case 'bestsellers':
                            this.selectCategory('bestsellers');
                            break;
                        case 'search':
                            const searchInput = document.getElementById('searchInput');
                            if (searchInput) {
                                searchInput.focus();
                            }
                            break;
                        case 'cart':
                            this.viewCart();
                            break;
                        default:
                            console.warn('Unknown navigation section:', section);
                            return false;
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Error in bottomNav:', error);
                    return false;
                }
            },

            // Category menu functions
            showCategoryMenu() {
                document.getElementById('categoryOverlay').classList.add('ml-active');
                document.body.style.overflow = 'hidden';
            },

            hideCategoryMenu() {
                document.getElementById('categoryOverlay').classList.remove('ml-active');
                document.body.style.overflow = '';
            },

            // Sort toggle
            toggleSort() {
                const sorts = ['popularity', 'price-low', 'price-high', 'name'];
                const labels = ['Popular', 'Price ↑', 'Price ↓', 'Name'];
                
                const currentIndex = sorts.indexOf(this.currentSort);
                const nextIndex = (currentIndex + 1) % sorts.length;
                
                this.currentSort = sorts[nextIndex];
                document.getElementById('sortLabel').textContent = labels[nextIndex];
                
                this.renderProducts(this.currentProducts);
            },

            // Cart functions
            changeQty(sku, delta) {
                const input = document.getElementById(`qty-${sku}`);
                let value = parseInt(input.value) + delta;
                if (value < 1) value = 1;
                if (value > 99) value = 99;
                input.value = value;
            },

            addToList(sku, buttonElement = null) {
                try {
                    // Input validation
                    if (!sku || typeof sku !== 'string') {
                        console.error('Invalid SKU provided to addToList');
                        return false;
                    }
                    
                    const product = this.catalog.products.find(p => p.sku === sku);
                    if (!product) {
                        console.error('Product not found:', sku);
                        return false;
                    }
                    
                    const qtyElement = document.getElementById(`qty-${sku}`);
                    if (!qtyElement) {
                        console.error('Quantity element not found for SKU:', sku);
                        return false;
                    }
                    
                    const qty = parseInt(qtyElement.value) || 1;
                    
                    // Check if item already in list
                    const existing = this.orderList.find(item => item.sku === sku);
                    if (existing) {
                        existing.quantity += qty;
                    } else {
                        this.orderList.push({
                            sku: product.sku,
                            name: product.name,
                            price: product.case_price,
                            quantity: qty
                        });
                    }
                    
                    // Save to localStorage
                    try {
                        localStorage.setItem('missionLinenOrderList', JSON.stringify(this.orderList));
                    } catch (storageError) {
                        console.error('Failed to save list:', storageError);
                    }
                    
                    // Update UI
                    this.updateListPanel();
                    this.showListPanel();
                    
                    // Reset quantity
                    qtyElement.value = 1;
                    
                    // Visual feedback
                    const btn = buttonElement || document.querySelector(`[onclick*="addToList('${sku}')"]`);
                    if (btn) {
                        const originalText = btn.innerHTML;
                        btn.innerHTML = '✓';
                        btn.style.background = 'var(--neon-green)';
                        
                        setTimeout(() => {
                            btn.innerHTML = originalText;
                            btn.style.background = '';
                        }, 1000);
                        
                        // Haptic feedback
                        this.addHapticFeedback(btn);
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Error in addToList:', error);
                    return false;
                }
            },

            // Keep old addToCart for compatibility but redirect to addToList
            addToCart(sku, buttonElement = null) {
                return this.addToList(sku, buttonElement);
            },

            updateCartCount() {
                const count = this.cart.reduce((sum, item) => sum + item.quantity, 0);
                document.getElementById('cartCount').textContent = count;
                document.getElementById('bottomCartCount').textContent = count;
                
                // Hide badge if empty
                const badges = document.querySelectorAll('#bottomCartCount');
                badges.forEach(badge => {
                    badge.style.display = count > 0 ? 'flex' : 'none';
                });
            },

            viewCart() {
                this.toggleListPanel();
            },

            // List Panel Functions
            updateListPanel() {
                const listItems = document.getElementById('listItems');
                const listCount = document.getElementById('listCount');
                const listTotal = document.getElementById('listTotal');
                const toggleBtn = document.getElementById('listToggleBtn');
                const toggleBadge = document.getElementById('listToggleBadge');
                
                if (this.orderList.length === 0) {
                    listItems.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 32px; margin-bottom: 10px;">📋</div>
                            <div>No items in list</div>
                            <div style="font-size: 11px; margin-top: 5px;">Add items to build your order</div>
                        </div>
                    `;
                    listCount.textContent = '(0)';
                    listTotal.textContent = '$0.00';
                    toggleBtn.classList.remove('ml-has-items');
                } else {
                    // Render list items
                    let html = '';
                    let total = 0;
                    
                    this.orderList.forEach((item, index) => {
                        const subtotal = item.price * item.quantity;
                        total += subtotal;
                        
                        html += `
                            <div class="ml-list-item">
                                <div class="ml-list-item-info">
                                    <div class="ml-list-item-name">${item.name}</div>
                                    <div class="ml-list-item-sku">SKU: ${item.sku}</div>
                                    <div class="ml-list-item-price">${item.quantity} × $${item.price.toFixed(2)} = $${subtotal.toFixed(2)}</div>
                                </div>
                                <div class="ml-list-item-controls">
                                    <button class="ml-list-item-remove" onclick="MissionLinen.removeFromList(${index})">×</button>
                                </div>
                            </div>
                        `;
                    });
                    
                    listItems.innerHTML = html;
                    listCount.textContent = `(${this.orderList.length})`;
                    listTotal.textContent = `$${total.toFixed(2)}`;
                    
                    // Show toggle button with badge
                    toggleBtn.classList.add('ml-has-items');
                    toggleBadge.textContent = this.orderList.length;
                }
            },

            removeFromList(index) {
                this.orderList.splice(index, 1);
                
                // Save to localStorage
                try {
                    localStorage.setItem('missionLinenOrderList', JSON.stringify(this.orderList));
                } catch (e) {
                    console.error('Failed to save list:', e);
                }
                
                this.updateListPanel();
                
                // Hide panel if empty
                if (this.orderList.length === 0) {
                    setTimeout(() => {
                        document.getElementById('listPanel').classList.remove('ml-active');
                    }, 500);
                }
            },

            clearList() {
                if (this.orderList.length === 0) return;
                
                if (confirm('Clear all items from the list?')) {
                    this.orderList = [];
                    
                    // Save to localStorage
                    try {
                        localStorage.setItem('missionLinenOrderList', JSON.stringify(this.orderList));
                    } catch (e) {
                        console.error('Failed to save list:', e);
                    }
                    
                    this.updateListPanel();
                    
                    // Hide panel
                    setTimeout(() => {
                        document.getElementById('listPanel').classList.remove('ml-active');
                    }, 500);
                }
            },

            toggleListPanel() {
                const panel = document.getElementById('listPanel');
                panel.classList.toggle('ml-active');
            },

            showListPanel() {
                const panel = document.getElementById('listPanel');
                if (!panel.classList.contains('ml-active')) {
                    panel.classList.add('ml-active');
                }
            },

            // Search
            setupSearch() {
                const searchInput = document.getElementById('searchInput');
                let searchTimeout;
                
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        const query = e.target.value.trim();
                        if (query) {
                            this.searchProducts(query);
                        } else {
                            this.loadView('all');
                        }
                    }, 300);
                });
            },

            searchProducts(query) {
                const results = this.catalog.products.filter(p => 
                    p.name.toLowerCase().includes(query.toLowerCase()) ||
                    p.sku.includes(query)
                );
                
                document.getElementById('pageTitle').innerHTML = `<span id="pageTitleIcon">🔍</span> Search Results`;
                this.renderProducts(results);
            },

            // Utility functions
            addHapticFeedback(element) {
                element.classList.add('ml-haptic');
                setTimeout(() => element.classList.remove('ml-haptic'), 100);
            },

            setupPullToRefresh() {
                let startY = 0;
                let currentY = 0;
                let isPulling = false;
                
                document.addEventListener('touchstart', (e) => {
                    if (window.pageYOffset === 0) {
                        startY = e.touches[0].pageY;
                        isPulling = true;
                    }
                });
                
                document.addEventListener('touchmove', (e) => {
                    if (isPulling) {
                        currentY = e.touches[0].pageY;
                        const pullDistance = currentY - startY;
                        
                        if (pullDistance > 50) {
                            document.getElementById('pullIndicator').classList.add('ml-active');
                        }
                    }
                });
                
                document.addEventListener('touchend', () => {
                    if (isPulling) {
                        const pullDistance = currentY - startY;
                        if (pullDistance > 100) {
                            // Trigger refresh
                            location.reload();
                        }
                        document.getElementById('pullIndicator').classList.remove('ml-active');
                        isPulling = false;
                    }
                });
            },

            // Favorites Management Functions
            isInAnyFavorites(sku) {
                return this.favorites.bestDeals.includes(sku) || 
                       this.favorites.customerFaves.includes(sku) || 
                       this.favorites.quickRef.includes(sku);
            },

            getFavoriteCategory(sku) {
                if (this.favorites.bestDeals.includes(sku)) return 'Best Deals';
                if (this.favorites.customerFaves.includes(sku)) return 'Customer Favorites';
                if (this.favorites.quickRef.includes(sku)) return 'Quick Reference';
                return null;
            },

            toggleFavorite(sku, buttonElement) {
                // Add to recently viewed
                this.addToRecentlyViewed(sku);
                
                // Check if already favorited
                const currentCategory = this.getFavoriteCategory(sku);
                
                if (currentCategory) {
                    // Remove from current category
                    this.removeFromFavorites(sku);
                    
                    // Update button appearance
                    buttonElement.style.background = 'rgba(0, 0, 0, 0.5)';
                    buttonElement.style.color = 'white';
                    buttonElement.innerHTML = '☆';
                    buttonElement.title = 'Add to favorites';
                    buttonElement.classList.remove('ml-favorited');
                    
                    this.showFavoriteFeedback('Removed from favorites', 'var(--neon-orange)');
                } else {
                    // Show category selection menu
                    this.showFavoriteCategoryMenu(sku, buttonElement);
                }
                
                // Save to storage and update UI
                this.saveFavorites();
                this.updateFavoriteCounts();
            },

            showFavoriteCategoryMenu(sku, buttonElement) {
                const menu = document.createElement('div');
                menu.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: var(--dark-bg);
                    border: 2px solid var(--neon-cyan);
                    border-radius: 15px;
                    padding: 20px;
                    z-index: 10000;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
                    max-width: 300px;
                    width: 90%;
                `;
                
                menu.innerHTML = `
                    <div style="color: var(--neon-green); font-size: 16px; margin-bottom: 15px; text-align: center;">
                        <strong>⭐ Add to Favorites</strong>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button onclick="MissionLinen.addToFavoriteCategory('${sku}', 'bestDeals', this.parentElement.parentElement)" 
                                style="background: var(--neon-green); color: black; border: none; padding: 10px; border-radius: 8px; cursor: pointer;">
                            💰 Best Deals
                        </button>
                        <button onclick="MissionLinen.addToFavoriteCategory('${sku}', 'customerFaves', this.parentElement.parentElement)" 
                                style="background: var(--neon-pink); color: black; border: none; padding: 10px; border-radius: 8px; cursor: pointer;">
                            👥 Customer Favorites
                        </button>
                        <button onclick="MissionLinen.addToFavoriteCategory('${sku}', 'quickRef', this.parentElement.parentElement)" 
                                style="background: var(--neon-purple); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer;">
                            ⚡ Quick Reference
                        </button>
                        <button onclick="this.parentElement.parentElement.remove()" 
                                style="background: rgba(255, 255, 255, 0.1); color: white; border: none; padding: 8px; border-radius: 8px; cursor: pointer; margin-top: 5px;">
                            Cancel
                        </button>
                    </div>
                `;
                
                document.body.appendChild(menu);
                
                // Store button reference for later update
                menu.dataset.buttonId = buttonElement.id || `btn-${sku}`;
                if (!buttonElement.id) {
                    buttonElement.id = `btn-${sku}`;
                }
            },

            addToFavoriteCategory(sku, category, menuElement) {
                // Add to the specified category
                if (!this.favorites[category].includes(sku)) {
                    this.favorites[category].push(sku);
                }
                
                // Update the button that triggered this
                const buttonId = menuElement.dataset.buttonId;
                const button = document.getElementById(buttonId);
                
                if (button) {
                    button.style.background = 'var(--neon-pink)';
                    button.style.color = 'black';
                    button.innerHTML = '⭐';
                    button.classList.add('ml-favorited');
                    
                    const categoryNames = {
                        'bestDeals': 'Best Deals',
                        'customerFaves': 'Customer Favorites', 
                        'quickRef': 'Quick Reference'
                    };
                    button.title = `Remove from ${categoryNames[category]}`;
                }
                
                // Remove menu
                menuElement.remove();
                
                // Save and update
                this.saveFavorites();
                this.updateFavoriteCounts();
                
                const categoryIcons = {
                    'bestDeals': '💰',
                    'customerFaves': '👥',
                    'quickRef': '⚡'
                };
                
                const categoryNames = {
                    'bestDeals': 'Best Deals',
                    'customerFaves': 'Customer Favorites', 
                    'quickRef': 'Quick Reference'
                };
                
                this.showFavoriteFeedback(`${categoryIcons[category]} Added to ${categoryNames[category]}!`, 'var(--neon-green)');
            },

            removeFromFavorites(sku) {
                this.favorites.bestDeals = this.favorites.bestDeals.filter(id => id !== sku);
                this.favorites.customerFaves = this.favorites.customerFaves.filter(id => id !== sku);
                this.favorites.quickRef = this.favorites.quickRef.filter(id => id !== sku);
            },

            addToRecentlyViewed(sku) {
                // Remove if already exists
                this.favorites.recentlyViewed = this.favorites.recentlyViewed.filter(id => id !== sku);
                
                // Add to beginning
                this.favorites.recentlyViewed.unshift(sku);
                
                // Keep only last 20 items
                if (this.favorites.recentlyViewed.length > 20) {
                    this.favorites.recentlyViewed = this.favorites.recentlyViewed.slice(0, 20);
                }
            },

            saveFavorites() {
                try {
                    localStorage.setItem('missionLinenFavorites', JSON.stringify(this.favorites));
                } catch (error) {
                    console.error('Failed to save favorites:', error);
                }
            },

            updateFavoriteCounts() {
                // Update category pill counts
                const pills = document.querySelectorAll('.ml-category-pill');
                pills.forEach(pill => {
                    const category = pill.dataset.category;
                    const countSpan = pill.querySelector('.ml-pill-count');
                    
                    if (countSpan) {
                        switch(category) {
                            case 'favorites':
                                countSpan.textContent = this.getTotalFavorites();
                                break;
                            case 'bestdeals':
                                countSpan.textContent = this.favorites.bestDeals.length;
                                break;
                            case 'quickref':
                                countSpan.textContent = this.favorites.quickRef.length;
                                break;
                        }
                    }
                });
            },

            showFavoriteFeedback(message, color) {
                const feedback = document.createElement('div');
                feedback.style.cssText = `
                    position: fixed;
                    top: 20%;
                    left: 50%;
                    transform: translateX(-50%);
                    background: ${color};
                    color: black;
                    padding: 10px 20px;
                    border-radius: 25px;
                    z-index: 10001;
                    font-weight: bold;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                    animation: fadeInOut 2s ease-in-out;
                `;
                
                feedback.innerHTML = message;
                document.body.appendChild(feedback);
                
                setTimeout(() => {
                    if (feedback.parentNode) {
                        feedback.remove();
                    }
                }, 2000);
            },

            // Copy Functions
            copyFormat(format) {
                if (this.orderList.length === 0) {
                    alert('No items in list to copy');
                    return;
                }
                
                let text = '';
                
                switch(format) {
                    case 'boss':
                        text = this.formatForBoss();
                        break;
                    case 'team':
                        text = this.formatForTeam();
                        break;
                    case 'customer':
                        text = this.formatForCustomer();
                        break;
                    case 'skus':
                        text = this.formatSKUsOnly();
                        break;
                    default:
                        text = this.formatForBoss();
                }
                
                // Copy to clipboard
                navigator.clipboard.writeText(text).then(() => {
                    // Visual feedback
                    const btn = event.target;
                    btn.classList.add('ml-copied');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '✓ Copied!';
                    
                    setTimeout(() => {
                        btn.classList.remove('ml-copied');
                        btn.innerHTML = originalText;
                    }, 2000);
                    
                    // Haptic feedback
                    if (navigator.vibrate) {
                        navigator.vibrate(50);
                    }
                }).catch(err => {
                    console.error('Failed to copy:', err);
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        alert('Copied to clipboard!');
                    } catch (err) {
                        alert('Failed to copy. Please try again.');
                    }
                    document.body.removeChild(textArea);
                });
            },

            formatForBoss() {
                const date = new Date().toLocaleDateString();
                const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                let total = 0;
                
                let text = `ORDER REQUEST\n`;
                text += `Customer: ${this.customerInfo.name} #${this.customerInfo.account}\n`;
                text += `Date: ${date} ${time}\n`;
                text += `---\n`;
                
                this.orderList.forEach(item => {
                    const subtotal = item.price * item.quantity;
                    total += subtotal;
                    text += `${item.sku} | ${item.name} | ${item.quantity}cs @ $${item.price.toFixed(2)} = $${subtotal.toFixed(2)}\n`;
                });
                
                text += `---\n`;
                text += `TOTAL: $${total.toFixed(2)}`;
                
                return text;
            },

            formatForTeam() {
                let text = '🔥 CHECK THESE DEALS!\n\n';
                
                this.orderList.forEach(item => {
                    text += `${item.name}\n`;
                    text += `SKU: ${item.sku}\n`;
                    text += `Price: $${item.price.toFixed(2)}/case\n`;
                    text += `Qty Available: ${item.quantity} cases\n`;
                    text += `---\n`;
                });
                
                return text;
            },

            formatForCustomer() {
                const date = new Date();
                const quoteNum = `Q${date.getFullYear()}${String(date.getMonth()+1).padStart(2,'0')}${String(date.getDate()).padStart(2,'0')}-${String(Math.floor(Math.random()*1000)).padStart(3,'0')}`;
                const validUntil = new Date(date.getTime() + 7*24*60*60*1000).toLocaleDateString();
                let total = 0;
                
                let text = `QUOTE #${quoteNum}\n`;
                text += `Valid Until: ${validUntil}\n\n`;
                
                this.orderList.forEach(item => {
                    const subtotal = item.price * item.quantity;
                    total += subtotal;
                    text += `${item.quantity} cases - ${item.name}\n`;
                });
                
                text += `\nEstimated Total: $${total.toFixed(2)}\n`;
                text += `*Pricing subject to final confirmation`;
                
                return text;
            },

            formatSKUsOnly() {
                return this.orderList.map(item => `${item.sku} x${item.quantity}`).join('\n');
            },

            shareList() {
                const text = this.formatForBoss();
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Mission Linen Order',
                        text: text
                    }).catch(err => {
                        console.log('Share cancelled or failed', err);
                    });
                } else {
                    // Fallback to copy
                    this.copyFormat('boss');
                }
            }
        };

        // PWA Installation
        let deferredPrompt;
        let isInstalled = false;

        // Check if app is already installed
        window.addEventListener('appinstalled', () => {
            console.log('PWA installed');
            isInstalled = true;
            hideInstallPrompt();
        });

        // Capture install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('Install prompt triggered');
            e.preventDefault();
            deferredPrompt = e;
            showInstallPrompt();
        });

        function showInstallPrompt() {
            if (isInstalled) return;
            
            // Create install banner
            const installBanner = document.createElement('div');
            installBanner.id = 'installBanner';
            installBanner.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background: linear-gradient(135deg, var(--neon-cyan), var(--neon-green));
                    color: black;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    z-index: 9999;
                    font-size: 14px;
                    box-shadow: 0 2px 10px rgba(0, 245, 255, 0.5);
                ">
                    <div>
                        <strong>📱 Install App</strong>
                        <div style="font-size: 11px; opacity: 0.8;">Works offline • Faster loading</div>
                    </div>
                    <div>
                        <button onclick="installApp()" style="
                            background: rgba(0, 0, 0, 0.2);
                            border: 1px solid rgba(0, 0, 0, 0.3);
                            color: black;
                            padding: 5px 12px;
                            border-radius: 15px;
                            margin-right: 10px;
                            cursor: pointer;
                            font-size: 12px;
                        ">Install</button>
                        <button onclick="hideInstallPrompt()" style="
                            background: transparent;
                            border: none;
                            color: black;
                            font-size: 18px;
                            cursor: pointer;
                            padding: 5px;
                        ">×</button>
                    </div>
                </div>
            `;
            
            // Only show if not already shown
            if (!document.getElementById('installBanner')) {
                document.body.appendChild(installBanner);
                
                // Auto-hide after 10 seconds
                setTimeout(() => {
                    hideInstallPrompt();
                }, 10000);
            }
        }

        function hideInstallPrompt() {
            const banner = document.getElementById('installBanner');
            if (banner) {
                banner.remove();
            }
        }

        async function installApp() {
            if (!deferredPrompt) return;
            
            const result = await deferredPrompt.prompt();
            console.log('Install prompt result:', result);
            
            deferredPrompt = null;
            hideInstallPrompt();
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('SW registered:', registration.scope);
                    
                    // Handle updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        if (newWorker) {
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdateAvailable();
                                }
                            });
                        }
                    });
                    
                } catch (error) {
                    console.log('SW registration failed:', error);
                }
            });
        }

        function showUpdateAvailable() {
            const updateBanner = document.createElement('div');
            updateBanner.innerHTML = `
                <div style="
                    position: fixed;
                    bottom: 70px;
                    left: 15px;
                    right: 15px;
                    background: var(--neon-green);
                    color: black;
                    padding: 10px 15px;
                    border-radius: 10px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    z-index: 999;
                    font-size: 14px;
                    box-shadow: 0 4px 20px rgba(57, 255, 20, 0.5);
                ">
                    <div>
                        <strong>Update Available</strong>
                        <div style="font-size: 11px; opacity: 0.8;">New features and improvements</div>
                    </div>
                    <button onclick="updateApp()" style="
                        background: rgba(0, 0, 0, 0.2);
                        border: 1px solid rgba(0, 0, 0, 0.3);
                        color: black;
                        padding: 5px 12px;
                        border-radius: 15px;
                        cursor: pointer;
                        font-size: 12px;
                    ">Update</button>
                </div>
            `;
            document.body.appendChild(updateBanner);
        }

        function updateApp() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.ready.then(registration => {
                    if (registration.waiting) {
                        registration.waiting.postMessage({ type: 'SKIP_WAITING' });
                        window.location.reload();
                    }
                });
            }
        }

        // Network status monitoring
        let isOnline = navigator.onLine;
        
        function updateNetworkStatus() {
            const wasOnline = isOnline;
            isOnline = navigator.onLine;
            
            if (!wasOnline && isOnline) {
                showNetworkStatus('🌐 Back Online', 'var(--neon-green)');
            } else if (wasOnline && !isOnline) {
                showNetworkStatus('📱 Working Offline', 'var(--neon-orange)');
            }
        }

        function showNetworkStatus(message, color) {
            const statusDiv = document.createElement('div');
            statusDiv.innerHTML = `
                <div style="
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: ${color};
                    color: black;
                    padding: 10px 20px;
                    border-radius: 25px;
                    z-index: 10000;
                    font-weight: bold;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                ">${message}</div>
            `;
            
            document.body.appendChild(statusDiv);
            
            setTimeout(() => {
                statusDiv.remove();
            }, 2000);
        }

        // Listen for network changes
        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => MissionLinen.init());

        // Handle back button
        window.addEventListener('popstate', () => {
            if (document.getElementById('categoryOverlay').classList.contains('ml-active')) {
                MissionLinen.hideCategoryMenu();
            }
        });
    </script>
</body>
</html>